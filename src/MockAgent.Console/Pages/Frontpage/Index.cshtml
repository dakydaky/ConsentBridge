@page
@model MockAgent.ConsoleApp.Pages.Frontpage.IndexModel
@{
    ViewData["Title"] = "Apply with ACME Agent";
}

<h2>Apply with ACME Agent</h2>
@if (!string.IsNullOrEmpty(Model.LoggedInEmail)) {
  <div class="alert alert-success">Logged in as <strong>@Model.LoggedInEmail</strong> · <a asp-page="/Frontpage/Index" asp-page-handler="Logout">Logout</a></div>
}
else {
  <div class="alert alert-info">Not logged in · <a asp-page="/Frontpage/Login">Login</a></div>
}
<p class="text-muted">Demo frontpage for candidates. Enter your email and the job, then we’ll request your consent.</p>

<form method="post">
    <div class="mb-3">
        <label class="form-label">Your Email</label>
        <input class="form-control" asp-for="Email" />
        <span class="text-danger" asp-validation-for="Email"></span>
    </div>
    <div class="mb-3">
        <label class="form-label">Job Reference</label>
        <input class="form-control" asp-for="JobRef" />
    </div>
    <button type="submit" class="btn btn-primary">Continue</button>
    <a class="btn btn-secondary" asp-page="/Index">Agent Dashboard</a>
  </form>

@if (!string.IsNullOrEmpty(Model.ConsentLink))
{
    <div class="alert alert-info mt-4">
        <div><strong>Next step:</strong> We’ve created a consent request. Open this link to verify your email and approve:</div>
        <div><a class="btn btn-sm btn-outline-primary" href="@Model.ConsentLink" target="_blank">Open Consent</a></div>
        <div class="form-text">In the real system, you’d receive this by email with a one-time code.</div>
    </div>
}

@if (Model.MyPending?.Count > 0 || Model.MyConsents?.Count > 0)
{
  <h3 class="mt-4">Your Status</h3>
  <div class="row">
    <div class="col-md-6">
      <h5>Pending Requests</h5>
      <ul>
      @foreach (var r in Model.MyPending!) {
        <li>@r.CreatedAt.ToLocalTime(): @r.Status · <a href="@Model.GatewayBaseUrl@r.link" target="_blank">Open</a></li>
      }
      </ul>
    </div>
    <div class="col-md-6">
      <h5>Active Consents</h5>
      <ul>
      @foreach (var c in Model.MyConsents!) {
        <li>ctok:@c.TokenId · exp @c.TokenExpiresAt.ToLocalTime()</li>
      }
      </ul>
    </div>
  </div>
}
