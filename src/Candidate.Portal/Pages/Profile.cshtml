@page
@model Candidate.PortalApp.Pages.ProfileModel
@{
    ViewData["Title"] = "Your Profile";
}

<h3>Your Profile</h3>
<p class="text-muted">This info is used to prefill applications your agent submits.</p>

<form method="post">
  <div class="row">
    <div class="col-md-6 mb-3">
      <label class="form-label">First Name</label>
      <input class="form-control" asp-for="Input.FirstName" />
    </div>
    <div class="col-md-6 mb-3">
      <label class="form-label">Last Name</label>
      <input class="form-control" asp-for="Input.LastName" />
    </div>
  </div>
  <div class="row">
    <div class="col-md-6 mb-3">
      <label class="form-label">Phone</label>
      <input class="form-control" asp-for="Input.Phone" />
    </div>
  </div>
  <div class="row">
    <div class="col-md-8 mb-3">
      <label class="form-label">CV URL</label>
      <input class="form-control" asp-for="Input.CvUrl" />
    </div>
    <div class="col-md-4 mb-3">
      <label class="form-label">CV SHA-256</label>
      <input class="form-control" asp-for="Input.CvSha256" />
    </div>
  </div>
  <div class="mb-3">
    <label class="form-label">Cover Letter (default)</label>
    <textarea class="form-control" asp-for="Input.CoverLetter" rows="4"></textarea>
  </div>
  <div class="d-flex gap-2">
    <button class="btn btn-primary" type="submit">Save</button>
    <button class="btn btn-outline-secondary" type="button" onclick="downloadProfile()">Download JSON</button>
  </div>
</form>

@section Scripts{
  <script>
    function downloadProfile(){
      const data = {
        firstName: document.querySelector('[name="Input.FirstName"]').value,
        lastName: document.querySelector('[name="Input.LastName"]').value,
        phone: document.querySelector('[name="Input.Phone"]').value,
        cvUrl: document.querySelector('[name="Input.CvUrl"]').value,
        cvSha256: document.querySelector('[name="Input.CvSha256"]').value,
        coverLetter: document.querySelector('[name="Input.CoverLetter"]').value,
      };
      const blob = new Blob([JSON.stringify(data, null, 2)], {type:'application/json'});
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = 'candidate-profile.json';
      document.body.appendChild(a); a.click(); a.remove();
    }
  </script>
}

